<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Attrition Prediction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
    .scrollable-container {
        max-height: 300px; /* Adjust height as needed */
        overflow-y: auto;
        border: 1px solid #ddd;
        padding: 10px;
        background: #fff;
    }

    </style>
</head>
<body class="bg-light">

    <div class="container mt-5">
        <h2 class="text-center">Employee Attrition Prediction</h2>
        
        <!-- Upload File -->
        <div class="card mt-4">
            <div class="card-body">
                <h5>Upload CSV File</h5>
                <input type="file" id="fileInput" class="form-control">
                <button class="btn btn-primary mt-2" onclick="uploadFile()">Upload</button>
                <p id="uploadStatus" class="mt-2"></p>
                <div id="dataPreview" class="mt-3 scrollable-container"></div>
            </div>
        </div>
        

        <!-- Perform EDA -->
        <div class="card mt-4">
            <div class="card-body">
                <h5>Perform Exploratory Data Analysis (EDA)</h5>
                <button class="btn btn-success" onclick="analyzeData()">Run EDA</button>
                <p id="edaStatus" class="mt-2"></p>
            </div>
        </div>

        <!-- Train Model -->
        <div class="card mt-4">
            <div class="card-body">
                <h5>Train Machine Learning Model</h5>
                <select id="modelChoice" class="form-select">
                    <option value="logistic">Logistic Regression</option>
                    <option value="random_forest">Random Forest</option>
                    <option value="decision_tree">Decision Tree</option>
                </select>
                <button class="btn btn-info mt-2" onclick="trainModel()">Train Model</button>
                <p id="trainStatus" class="mt-2"></p>
            </div>
        </div>

        <!-- Predict Attrition -->
        <div class="card mt-4">
            <div class="card-body">
                <h5>Predict Employee Attrition</h5>
                <form id="predictForm">
                    <div id="inputFields"></div>
                    <button type="button" class="btn btn-primary mt-2" onclick="predictAttrition()">Predict</button>
                </form>
                <p id="predictionResult" class="mt-2"></p>
                <div id="predictionTable" class="mt-3 scrollable-container"></div>
            </div>
        </div>
    </div>

    <script>
        let featureColumns = [];
        let categoricalColumns = {};
        let numericRanges = {};

        function uploadFile() {
            let fileInput = document.getElementById('fileInput').files[0];
            if (!fileInput) {
                document.getElementById('uploadStatus').innerText = "No file selected!";
                return;
            }
            let formData = new FormData();
            formData.append('file', fileInput);

            fetch('/upload', { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('uploadStatus').innerText = data.message;
                    if (data.sample_data) {
                        displayDataPreview(data.sample_data);
                    }
                    if (data.features) {
                        featureColumns = data.features;
                        categoricalColumns = data.categorical_columns;
                        numericRanges = data.numeric_ranges;
                        generateInputFields();
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function displayDataPreview(data) {
            let table = `<table class="table table-bordered mt-3"><thead><tr>`;
            let keys = Object.keys(data[0]);
            keys.forEach(key => table += `<th>${key}</th>`);
            table += `</tr></thead><tbody>`;

            data.forEach(row => {
                table += `<tr>`;
                keys.forEach(key => table += `<td>${row[key]}</td>`);
                table += `</tr>`;
            });

            table += `</tbody></table>`;
            document.getElementById('dataPreview').innerHTML = table;
        }

        function analyzeData() {
            fetch('/analyze', { method: 'POST' })
                .then(response => response.json())
                .then(data => document.getElementById('edaStatus').innerText = data.message)
                .catch(error => console.error('Error:', error));
        }

        function trainModel() {
            let modelChoice = document.getElementById('modelChoice').value;
            let formData = new FormData();
            formData.append('model_choice', modelChoice);

            fetch('/train', { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => document.getElementById('trainStatus').innerText = data.message)
                .catch(error => console.error('Error:', error));
        }

        function generateInputFields() {
            let inputDiv = document.getElementById('inputFields');
            inputDiv.innerHTML = '';
            
            featureColumns.forEach(col => {
                if (categoricalColumns[col]) {
                    let dropdown = `<label class='form-label'>${col}</label><select class='form-select' name='${col}'>`;
                    categoricalColumns[col].forEach(option => {
                        dropdown += `<option value='${option}'>${option}</option>`;
                    });
                    dropdown += `</select>`;
                    inputDiv.innerHTML += dropdown;
                } else {
                    let range = numericRanges[col] ? ` (Min: ${numericRanges[col].min}, Max: ${numericRanges[col].max})` : '';
                    let inputGroup = `<label class='form-label'>${col}${range}</label><input type='number' class='form-control' name='${col}' required>`;
                    inputDiv.innerHTML += inputGroup;
                }
            });
        }

        function predictAttrition() {
            let formData = new FormData(document.getElementById('predictForm'));
            fetch('/predict', { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('predictionResult').innerText = "Predicted Attrition: " + data.prediction;
                    displayPredictionTable(data.details, data.prediction);
                })
                .catch(error => console.error('Error:', error));
        }

        function displayPredictionTable(details, prediction) {
            let table = `<table class="table table-bordered mt-3"><thead><tr>`;
            let keys = Object.keys(details);
            keys.forEach(key => table += `<th>${key}</th>`);
            table += `<th>Predicted Attrition</th></tr></thead><tbody><tr>`;
            keys.forEach(key => table += `<td>${details[key]}</td>`);
            table += `<td>${prediction}</td></tr></tbody></table>`;
            document.getElementById('predictionTable').innerHTML = table;
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>